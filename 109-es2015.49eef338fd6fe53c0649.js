(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{"2QGa":function(t,e,c){"use strict";c.d(e,"a",(function(){return o}));var n=c("F97/"),i=c("SeVD"),a=c("pLZG"),s=c("HDdC");function o(t,e,c){return[Object(a.a)(e,c)(new s.a(Object(i.a)(t))),Object(a.a)(Object(n.a)(e,c))(new s.a(Object(i.a)(t)))]}},bgXO:function(t,e,c){"use strict";c.r(e),c.d(e,"CONTAINERS",(function(){return gt})),c.d(e,"COMPONENTS",(function(){return Ot})),c.d(e,"BsBatchLogModule",(function(){return mt}));var n={};c.r(n),c.d(n,"initBatchComponentStateAction",(function(){return v})),c.d(n,"loadBatchListAction",(function(){return x})),c.d(n,"loadBatchListSuccessAction",(function(){return A})),c.d(n,"loadBatchListFailureAction",(function(){return S})),c.d(n,"executeBatchAction",(function(){return w})),c.d(n,"executeBatchSuccessAction",(function(){return k})),c.d(n,"executeBatchFailureAction",(function(){return I}));var i=c("ofXK"),a=c("3Pt+"),s=c("snw9"),o=c("kt0X"),r=c("vu/V"),u=c("7rOj"),l=c("6LsY"),b=c("v7zA"),h=c("hHe4"),p=c("5hwk"),d=c("kKjH"),f=c("qXPF"),g=c("1OXJ"),O=c("7UZF"),m=c("l1P7"),j=c("w8np"),B=c("tyNb"),L=c("EVqC");const v=Object(o.o)("[BsBatchLog] init component state"),x=Object(o.o)("[BsBatchLog] load list"),A=Object(o.o)("[BsBatchLog] load list success",Object(o.t)()),S=Object(o.o)("[BsBatchLog] load list failure",Object(o.t)()),w=Object(o.o)("[BsBatchLog] execute batch",Object(o.t)()),k=Object(o.o)("[BsBatchLog] execute batch success"),I=Object(o.o)("[BsBatchLog] execute batch failure",Object(o.t)()),N=Object(L.a)({selectId:t=>t.batchCode,sortComparer:!1}).getInitialState({batchList:null,gridState:{pageInfo:{skip:0,take:20},sortInfo:[]}}),E=Object(o.q)(N,Object(o.s)(n.loadBatchListAction,t=>Object.assign(Object.assign({},t),{loading:!0})),Object(o.s)(n.loadBatchListSuccessAction,(t,{dataList:e})=>Object.assign(Object.assign({},t),{batchList:e,loading:!1,gridState:{pageInfo:{skip:0,take:20},sortInfo:[]}})),Object(o.s)(n.loadBatchListFailureAction,t=>Object.assign(Object.assign({},t),{loading:!1})),Object(o.s)(n.executeBatchAction,t=>Object.assign(Object.assign({},t),{loading:!0})),Object(o.s)(n.executeBatchSuccessAction,t=>Object.assign(Object.assign({},t),{loading:!1})),Object(o.s)(n.executeBatchFailureAction,t=>Object.assign(Object.assign({},t),{loading:!1})));function C(t,e){return Object(o.m)({BsBatchLogList:E})(t,e)}const F=Object(o.p)("bsBatchLog"),P=Object(o.r)(F,t=>t.BsBatchLogList),$=Object(o.r)(P,t=>t.batchList);Object(o.r)(P,t=>t.gridState);var V=c("LvDl"),_=c("XNiG"),y=c("fXoL"),T=c("LRne"),G=c("z6cu"),W=c("eIep"),Y=c("AytR");const{API_URL:R}=Y.a,U={postBatchList:`${R}/admin/basis/batch-log`};var H=c("tpT/");const{API_URL:X}=Y.a;let D=(()=>{class t{constructor(t){this.api=t}getBatchList(t){const e=V.assign({},this.api.defaultParams,{condition:t});return this.api.post(U.postBatchList,e).pipe(Object(W.a)(t=>{if(t.succeedYn&&t.result){const e=t.result;return Object(T.a)(e)}return Object(G.a)(t||"api response error")}))}excuteBatch(t){return this.api.get(`${X}${t}`).pipe(Object(W.a)(t=>200===t.status?Object(T.a)(t):Object(G.a)(t||"api response error")))}}return t.\u0275fac=function(e){return new(e||t)(y.bc(H.a))},t.\u0275prov=y.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),M=(()=>{class t{constructor(t){this.fb=t,this.generateGridColumns=()=>[{field:"autoYn",title:"Auto YN",width:75,template:"autoYnTpl"},{field:"startDatetime",title:"From ~ To Time",width:270,template:"executeTime"},{field:"manualActionName",title:"User",width:100},{field:"controlRemark",title:"Remark",width:200}]}}return t.\u0275fac=function(e){return new(e||t)(y.bc(a.f))},t.\u0275prov=y.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var J=c("EsKh");let K=(()=>{class t{constructor(t){this.alertService=t,this.exeEvent=new y.n}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(J.a))},t.\u0275cmp=y.Kb({type:t,selectors:[["app-bs-batch-log-control"]],inputs:{name:"name",url:"url",enableButton:"enableButton"},outputs:{exeEvent:"exeEvent"},decls:7,vars:2,consts:[[1,"grid-control-area"],[1,"form-label"],[1,"ml30","d-inline-flex","flex-glow-0"],[1,"ml-auto","d-inline-flex","flex-glow-0"],[1,"btn","btn-outline-dark","sm",2,"margin-right","10px",3,"disabled","click"]],template:function(t,e){1&t&&(y.Wb(0,"div",0),y.Wb(1,"span",1),y.Pc(2),y.Vb(),y.Rb(3,"div",2),y.Wb(4,"div",3),y.Wb(5,"button",4),y.fc("click",(function(){return e.exeEvent.emit(e.url)})),y.Pc(6,"Run"),y.Vb(),y.Vb(),y.Vb()),2&t&&(y.Cb(2),y.Qc(e.name),y.Cb(3),y.pc("disabled",!e.enableButton))},encapsulation:2,changeDetection:0}),t})();var Q=c("UIHd");function q(t,e){1&t&&(y.Wb(0,"span"),y.Pc(1,"Y"),y.Vb())}function z(t,e){1&t&&(y.Wb(0,"span"),y.Pc(1,"N"),y.Vb())}function Z(t,e){if(1&t&&(y.Nc(0,q,2,0,"span",11),y.Nc(1,z,2,0,"span",11)),2&t){const t=e.$implicit;y.pc("ngIf",!0===t.autoYn),y.Cb(1),y.pc("ngIf",!1===t.autoYn)}}function tt(t,e){if(1&t&&(y.Wb(0,"span"),y.Pc(1),y.Vb()),2&t){const t=e.$implicit;y.Cb(1),y.Sc("",t.startDatetime," ~ ",t.endDatetime,"")}}const et=function(){return{skip:0,take:20}},ct=function(){return[]},nt=function(t,e){return{pageInfo:t,sortInfo:e}},it=function(t,e){return{autoYnTpl:t,executeTime:e}};function at(t,e){if(1&t){const t=y.Xb();y.Ub(0),y.Wb(1,"div",6),y.Wb(2,"app-bs-batch-log-control",7),y.fc("exeEvent",(function(e){return y.Fc(t),y.hc(2).clickExecuteHandler(e)})),y.Vb(),y.Nc(3,Z,2,2,"ng-template",null,8,y.Oc),y.Nc(5,tt,2,2,"ng-template",null,9,y.Oc),y.Rb(7,"app-grid-simple",10),y.Vb(),y.Tb()}if(2&t){const t=e.$implicit,c=y.Ec(4),n=y.Ec(6),i=y.hc(2);y.Cb(2),y.pc("name",t.batchNameEn)("url",t.batchUrl)("enableButton",t.manualActionYn),y.Cb(5),y.Eb("grid-max-height-200"),y.pc("columns",i.columns)("gridState",y.vc(13,nt,y.tc(11,et),y.tc(12,ct)))("hidePagination",!0)("dataList",t.logList)("templates",y.vc(16,it,c,n))("isHiddenGridSetup",!0)}}function st(t,e){if(1&t&&(y.Ub(0),y.Wb(1,"div",5),y.Nc(2,at,8,19,"ng-container",0),y.Vb(),y.Tb()),2&t){const t=e.$implicit;y.Cb(2),y.pc("ngForOf",t)}}const ot=function(t){return{display:t}};let rt=(()=>{class t{constructor(t,e){this.store=t,this.dataService=e,this.batchGroupList=[],this.loading=!0,this._unsubscribe$=new _.a,this.loading=!0,this.batchList$=t.pipe(Object(o.u)($)),this.columns=this.dataService.generateGridColumns()}ngOnInit(){this.store.dispatch(n.loadBatchListAction())}ngAfterContentInit(){this._initSubscription()}ngOnDestroy(){this._unsubscribe$.next(),this._unsubscribe$.complete()}clickExecuteHandler(t){this.store.dispatch(n.executeBatchAction({batchUrl:t}))}_initSubscription(){this.batchList$.subscribe(t=>{V.isNil(t)||(this.batchGroupList=this._convertToGroupList(t),console.log(this.batchGroupList),this.loading=!1)})}_convertToGroupList(t){return t.reduce((t,e,c)=>{const n=Math.floor(c/3);return V.isNil(t[n])&&t.push([]),t[n].push(e),t},[])}}return t.\u0275fac=function(e){return new(e||t)(y.Qb(o.h),y.Qb(M))},t.\u0275cmp=y.Kb({type:t,selectors:[["app-bs-batch-log"]],decls:6,vars:4,consts:[[4,"ngFor","ngForOf"],[2,"position","absolute","top","50%","left","50%",3,"ngStyle"],[1,"content-loading","align-items-center"],[1,"icon-loading","lg"],[1,"loading-title"],[1,"frame-wrap","basis-3",2,"margin-top","24px"],[1,"frame"],[3,"name","url","enableButton","exeEvent"],["autoYnTpl",""],["executeTime",""],[3,"columns","gridState","hidePagination","dataList","templates","isHiddenGridSetup"],[4,"ngIf"]],template:function(t,e){1&t&&(y.Nc(0,st,3,1,"ng-container",0),y.Wb(1,"div",1),y.Wb(2,"div",2),y.Rb(3,"div",3),y.Wb(4,"div",4),y.Pc(5,"loading..."),y.Vb(),y.Vb(),y.Vb()),2&t&&(y.pc("ngForOf",e.batchGroupList),y.Cb(1),y.pc("ngStyle",y.uc(2,ot,e.loading?"flex":"none")))},directives:[i.n,i.p,K,Q.a,i.o],encapsulation:2}),t})();const ut=[{path:"",component:rt,data:{title:"Batch Log"}}];let lt=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[B.f.forChild(ut)],B.f]}),t})();var bt=c("lJxs"),ht=c("JIr8"),pt=c("vkgz"),dt=c("Xb6A");let ft=(()=>{class t{constructor(t,e,c,i,a){this.actions$=t,this.service=e,this._errorService=c,this.store=i,this.alertService=a,this.loadBatchList$=Object(s.c)(()=>this.actions$.pipe(Object(s.d)(n.loadBatchListAction),Object(W.a)(()=>this.service.getBatchList({}).pipe(Object(bt.a)(t=>n.loadBatchListSuccessAction({dataList:t})),Object(ht.a)(t=>{const e="\ubc30\uce58 \ub9ac\uc2a4\ud2b8 \uc870\ud68c\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4.",c=[n.loadBatchListFailureAction({error:e})];return this._catchErr(t,e,c),[]}))))),this.executeBatch$=Object(s.c)(()=>this.actions$.pipe(Object(s.d)(n.executeBatchAction),Object(W.a)(({batchUrl:t})=>this.service.excuteBatch(t).pipe(Object(bt.a)(()=>({succeedYn:!0})))),Object(pt.a)(({succeedYn:t,error:e})=>{if(t){const t=[n.loadBatchListAction()];this._runPage("\ubc30\uce58\uac00 \uc2e4\ud589\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",t)}else{const t=[n.executeBatchFailureAction({error:"\uc608\uc57d\ub9e4\ud551 \ucde8\uc18c\ub97c \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."})];this._catchErr(e,"\ubc30\uce58\uac00 \uc2e4\ud589\ub418\uc9c0 \ubabb\ud558\uc600\uc2b5\ub2c8\ub2e4.",t)}})),{dispatch:!1})}_runPage(t,e){this.alertService.alert({message:t,accept:(null==e?void 0:e.length)>0?()=>{e.forEach(t=>{this.store.dispatch(t)})}:()=>{}})}_catchErr(t,e,c){const n=this._errorService.errorHandler(t,e);V.isNil(n)||(V.isNil(n.accept)&&(n.accept=(null==c?void 0:c.length)>0?()=>{c.forEach(t=>{this.store.dispatch(t)})}:()=>{}),this.alertService.alert(n))}}return t.\u0275fac=function(e){return new(e||t)(y.bc(s.a),y.bc(D),y.bc(dt.a),y.bc(o.h),y.bc(J.a))},t.\u0275prov=y.Mb({token:t,factory:t.\u0275fac}),t})();const gt=[rt],Ot=[K];let mt=(()=>{class t{}return t.\u0275mod=y.Ob({type:t}),t.\u0275inj=y.Nb({factory:function(e){return new(e||t)},imports:[[i.c,a.m,a.w,r.a,u.a,b.a,l.a,h.a,p.a,d.a,f.a,g.a,O.a,m.a,j.a,lt,o.j.forFeature("bsBatchLog",C),s.b.forFeature([ft])]]}),t})()}}]);