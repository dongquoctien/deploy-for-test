(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"6H05":function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("fXoL"),r=i("LvDl"),s=i("9Wiz"),a=i("EsKh"),o=i("3Pt+"),c=i("+Sob"),l=i("gbCm"),m=i("NCYe");let d=(()=>{class e{constructor(e,t){this._dataService=e,this._alertService=t,this.sendEmailEvent=new n.n,this.closeEvent=new n.n,this.postForm=e.generateReservationSendEmailTemplatePostForm()}ngOnInit(){this._setPostFormData()}onSubmit(){if(this.postForm.invalid)return this._checkValid=!0,void Object.keys(this.postForm.controls).forEach(e=>{this.postForm.controls[e].invalid&&console.error(e+" is invalid")});const e=this._setPostFormCondition(this.postForm.value);e&&this.sendEmailEvent.emit(e)}checkIsInvalid(e){return this._checkValid&&this.postForm.get(e)&&this.postForm.get(e).invalid}onClose(){this.closeEvent.emit()}_setPostFormData(){this.postFormData=this._dataService.initReservationSendEmailTemplatePostForm()}_setPostFormCondition(e){let t;const{receiverName:i,receiverEmailAddress:n,ccReceiverName:s,ccEmailAddress:a,bccReceiverName:o,bccEmailAddress:c,senderName:l,senderEmailAddress:m,memoTitle:d,emailComment:b}=e,u=this._getReceiverListByMapping(i,n,"Receiver"),p=this._getReceiverListByMapping(s,a,"CC Receiver"),v=this._getReceiverListByMapping(o,c,"BCC Receiver");if(!u||!p||!v)return null;if(this.bookingItemCode){const e=this.bookingItemCode.substring(0,this.bookingItemCode.length-3),i=this._getItemCategoryCodeByBookingItemCode(this.bookingItemCode);if(!i)return null;t={sender:{emailAddress:m,name:l,userNo:this.userNo},receivers:u,ccReceivers:p,bccReceivers:v,smsSendYn:!1,emailSendYn:!0,emailTitle:d,emailDetail:this.emailTemplate.replace(/\n/g,""),bookingCode:e,bookingItemCode:this.bookingItemCode,itemCategoryCode:i}}else t={sender:{emailAddress:m,name:l,userNo:this.userNo},receivers:u,ccReceivers:p,bccReceivers:v,smsSendYn:!1,emailSendYn:!0,emailTitle:d,emailDetail:this.emailTemplate.replace(/\n/g,"")};return b&&b.length>0&&(t=Object.assign({},t,{emailComment:b})),r.omitBy(t,this.isEmptyArray)}_getReceiverListByMapping(e,t,i){if(!e&&t||e&&!t)return console.error("names and emails length is not same",i),this._alertService.alert("The number of "+i+"'s emails and names is different. Please match the number of emails and names."),null;if(!e&&!t)return[];const n=e.split(";"),r=t.split(";");return n.length!==r.length?(console.error("names and emails length is not same",i,n,r),this._alertService.alert("The number of "+i+"'s emails and names is different. Please match the number of emails and names."),null):r.some(e=>!this._checkEmail(e))?(console.error("email is invalid",i,r),this._alertService.alert("The email format is incorrect. Please check the email format."),null):n.map((e,t)=>({name:e,emailAddress:r[t]}))}_checkEmail(e){return new RegExp(/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]+$/).test(e)}_getItemCategoryCodeByBookingItemCode(e){const t=e.substring(e.length-3,e.length-2);switch(t){case"F":return"IC01";case"H":return"IC02";case"C":return"IC03";case"A":return"IC04";default:return console.error("Failed to parse itemCategory Character from bookingItemCode",t,e),this._alertService.alert("Error!: Call Developer (Failed to parse itemCategory Character from bookingItemCode)"),null}}isEmptyArray(e){return"object"==typeof e&&0===e.length}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(s.a),n.Qb(a.a))},e.\u0275cmp=n.Kb({type:e,selectors:[["app-send-email-template-form"]],inputs:{emailTitle:"emailTitle",emailTemplate:"emailTemplate",itemCategoryCode:"itemCategoryCode",bookingItemCode:"bookingItemCode",userNo:"userNo"},outputs:{sendEmailEvent:"sendEmailEvent",closeEvent:"closeEvent"},decls:80,vars:15,consts:[[3,"formGroup","connectForm","ngSubmit"],[1,"table","table-bordered","table-responsive"],["width","30%"],["scope","row",1,"th-bg"],["formControlName","receiverName",3,"isInvalid"],["formControlName","receiverEmailAddress",3,"isInvalid"],["formControlName","ccReceiverName",3,"isInvalid"],["formControlName","ccEmailAddress",3,"isInvalid"],["formControlName","bccReceiverName",3,"isInvalid"],["formControlName","bccEmailAddress",3,"isInvalid"],["formControlName","senderName",3,"isInvalid"],["formControlName","senderEmailAddress",3,"isInvalid"],["formControlName","memoTitle",3,"isInvalid"],["formControlName","emailComment",3,"isInvalid"],[1,"button-area","align-r","mt20","mb20"],["type","submit",1,"btn","btn-light","sm"],[1,"btn","btn-secondary","sm",3,"click"],[1,"table","table-bordered","table-fixed","mt20"],["colspan","2",2,"padding","25px"],[3,"innerHTML"]],template:function(e,t){1&e&&(n.Wb(0,"form",0),n.fc("ngSubmit",(function(){return t.onSubmit()})),n.Wb(1,"div",1),n.Wb(2,"table"),n.Wb(3,"caption"),n.Pc(4," Email "),n.Vb(),n.Wb(5,"colgroup"),n.Rb(6,"col",2),n.Rb(7,"col"),n.Vb(),n.Wb(8,"tbody"),n.Wb(9,"tr"),n.Wb(10,"th",3),n.Wb(11,"sup"),n.Pc(12,"Receiver Name"),n.Vb(),n.Vb(),n.Wb(13,"td"),n.Rb(14,"app-input-text",4),n.Vb(),n.Vb(),n.Wb(15,"tr"),n.Wb(16,"th",3),n.Wb(17,"sup"),n.Pc(18,"Receiver Email Address"),n.Vb(),n.Vb(),n.Wb(19,"td"),n.Rb(20,"app-input-text",5),n.Vb(),n.Vb(),n.Wb(21,"tr"),n.Wb(22,"th",3),n.Pc(23,"CC Receiver Name"),n.Vb(),n.Wb(24,"td"),n.Rb(25,"app-input-text",6),n.Vb(),n.Vb(),n.Wb(26,"tr"),n.Wb(27,"th",3),n.Pc(28,"CC Receiver Email Address"),n.Vb(),n.Wb(29,"td"),n.Rb(30,"app-input-text",7),n.Vb(),n.Vb(),n.Wb(31,"tr"),n.Wb(32,"th",3),n.Pc(33,"BCC Receiver Name"),n.Vb(),n.Wb(34,"td"),n.Rb(35,"app-input-text",8),n.Vb(),n.Vb(),n.Wb(36,"tr"),n.Wb(37,"th",3),n.Pc(38,"BCC Receiver Email Address"),n.Vb(),n.Wb(39,"td"),n.Rb(40,"app-input-text",9),n.Vb(),n.Vb(),n.Wb(41,"tr"),n.Wb(42,"th",3),n.Wb(43,"sup"),n.Pc(44,"Sender Name"),n.Vb(),n.Vb(),n.Wb(45,"td"),n.Rb(46,"app-input-text",10),n.Vb(),n.Vb(),n.Wb(47,"tr"),n.Wb(48,"th",3),n.Wb(49,"sup"),n.Pc(50,"Sender Email Address"),n.Vb(),n.Vb(),n.Wb(51,"td"),n.Rb(52,"app-input-text",11),n.Vb(),n.Vb(),n.Wb(53,"tr"),n.Wb(54,"th",3),n.Wb(55,"sup"),n.Pc(56,"UMS Title"),n.Vb(),n.Vb(),n.Wb(57,"td"),n.Rb(58,"app-input-text",12),n.Vb(),n.Vb(),n.Wb(59,"tr"),n.Wb(60,"th",3),n.Pc(61,"Email Comment"),n.Vb(),n.Wb(62,"td"),n.Rb(63,"app-input-text",13),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Wb(64,"div",14),n.Wb(65,"button",15),n.Pc(66,"Send"),n.Vb(),n.Wb(67,"button",16),n.fc("click",(function(){return t.onClose()})),n.Pc(68,"Close"),n.Vb(),n.Vb(),n.Wb(69,"div",17),n.Wb(70,"table"),n.Wb(71,"caption"),n.Pc(72," \uc774\uba54\uc77c \ubcf4\uc5ec\uc8fc\uae30 "),n.Vb(),n.Wb(73,"colgroup"),n.Rb(74,"col"),n.Vb(),n.Wb(75,"tbody"),n.Wb(76,"tr"),n.Wb(77,"td",18),n.Rb(78,"div",19),n.ic(79,"sanitizeHtml"),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb(),n.Vb()),2&e&&(n.pc("formGroup",t.postForm)("connectForm",t.postFormData),n.Cb(14),n.pc("isInvalid",t.checkIsInvalid("receiverName")),n.Cb(6),n.pc("isInvalid",t.checkIsInvalid("receiverEmailAddress")),n.Cb(5),n.pc("isInvalid",t.checkIsInvalid("ccReceiverName")),n.Cb(5),n.pc("isInvalid",t.checkIsInvalid("ccEmailAddress")),n.Cb(5),n.pc("isInvalid",t.checkIsInvalid("bccReceiverName")),n.Cb(5),n.pc("isInvalid",t.checkIsInvalid("bccEmailAddress")),n.Cb(6),n.pc("isInvalid",t.checkIsInvalid("senderName")),n.Cb(6),n.pc("isInvalid",t.checkIsInvalid("senderEmailAddress")),n.Cb(6),n.pc("isInvalid",t.checkIsInvalid("memoTitle")),n.Cb(5),n.pc("isInvalid",t.checkIsInvalid("emailComment")),n.Cb(15),n.pc("innerHTML",n.jc(79,13,t.emailTemplate),n.Gc))},directives:[o.B,o.s,o.k,c.a,l.a,o.r,o.i],pipes:[m.d],encapsulation:2}),e})()},"9Wiz":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("3Pt+"),r=i("6UzV"),s=i("fXoL");let a=(()=>{class e{constructor(e){this.fb=e,this.generateReservationSendEmailTemplatePostForm=()=>this.fb.group({receiverName:[null,[n.z.required]],receiverEmailAddress:[null,[r.a.email(),n.z.required]],ccReceiverName:[null],ccEmailAddress:[null],bccReceiverName:[null],bccEmailAddress:[null],senderName:[null,[n.z.required]],senderEmailAddress:[null,[r.a.email(),n.z.required]],memoTitle:[null],emailComment:[null]}),this.initReservationSendEmailTemplatePostForm=()=>({receiverName:null,receiverEmailAddress:null,ccReceiverName:null,ccEmailAddress:null,bccReceiverName:null,bccEmailAddress:null,senderName:null,senderEmailAddress:"cscenter@ohmyhotel.com",memoTitle:null,emailComment:null})}}return e.\u0275fac=function(t){return new(t||e)(s.bc(n.f))},e.\u0275prov=s.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},CNCE:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("fXoL"),r=i("Vwu0"),s=i("kt0X"),a=i("6H05");let o=(()=>{class e{constructor(e){this._store=e,this.closeEvent=new n.n}ngOnInit(){}sendUmsHandler(e){this._store.dispatch(r.a.sendUmsAction({condition:e}))}closeHandler(){this.closeEvent.emit()}}return e.\u0275fac=function(t){return new(t||e)(n.Qb(s.h))},e.\u0275cmp=n.Kb({type:e,selectors:[["app-send-email-template"]],inputs:{emailTitle:"emailTitle",emailTemplate:"emailTemplate",itemCategoryCode:"itemCategoryCode",bookingItemCode:"bookingItemCode",userNo:"userNo"},outputs:{closeEvent:"closeEvent"},decls:1,vars:5,consts:[[3,"emailTitle","emailTemplate","itemCategoryCode","bookingItemCode","userNo","sendEmailEvent","closeEvent"]],template:function(e,t){1&e&&(n.Wb(0,"app-send-email-template-form",0),n.fc("sendEmailEvent",(function(e){return t.sendUmsHandler(e)}))("closeEvent",(function(){return t.closeHandler()})),n.Vb()),2&e&&n.pc("emailTitle",t.emailTitle)("emailTemplate",t.emailTemplate)("itemCategoryCode",t.itemCategoryCode)("bookingItemCode",t.bookingItemCode)("userNo",t.userNo)},directives:[a.a],encapsulation:2}),e})()},N7Iw:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));const n=e=>("string"==typeof e&&(e=Number(e)),e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))},Vwu0:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n={};i.r(n),i.d(n,"sendUmsAction",(function(){return s})),i.d(n,"sendUmsSuccessAction",(function(){return a})),i.d(n,"sendUmsFailureAction",(function(){return o}));var r=i("kt0X");const s=Object(r.o)("[SendEmailTemplate] load send ums",Object(r.t)()),a=Object(r.o)("[SendEmailTemplate] load send ums success"),o=Object(r.o)("[SendEmailTemplate] load send ums failure",Object(r.t)())},kZba:function(e,t,i){"use strict";i.d(t,"a",(function(){return U}));var n=i("ofXK"),r=i("3Pt+"),s=i("snw9"),a=i("kt0X"),o=i("WG3B"),c=i("xoAz"),l=i("vu/V"),m=i("l1P7"),d=i("5hwk"),b=i("+NQf"),u=i("7UZF"),p=i("v7zA"),v=i("hHe4"),h=i("6LsY"),f=i("7rOj");i("CNCE"),i("6H05");const C=Object(a.q)({emailTemplate:null});function g(e,t){return Object(a.m)({sendEmailTemplate:C})(e,t)}var I=i("Vwu0"),E=i("LvDl"),V=i("eIep"),W=i("lJxs"),N=i("JIr8"),k=i("vkgz"),R=i("LRne"),A=i("fXoL"),S=i("EsKh"),T=i("Xb6A"),y=i("z6cu"),_=i("AytR");const{API_URL:P}=_.a,w={postUmsSend:`${P}/common/ums/send`};var F=i("tpT/");let j=(()=>{class e{constructor(e){this.api=e}sendUms(e){const t=E.assign({},this.api.defaultParams,{condition:e});return this.api.post(w.postUmsSend,t).pipe(Object(V.a)(e=>e.succeedYn?Object(R.a)(e.result):Object(y.a)(e||"api response error")))}}return e.\u0275fac=function(t){return new(t||e)(A.bc(F.a))},e.\u0275prov=A.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();i("9Wiz");let O=(()=>{class e{constructor(e,t,i,n,r){this._store=e,this._alertService=t,this._errorService=i,this._actions=n,this._apiService=r,this.sendUms$=Object(s.c)(()=>this._actions.pipe(Object(s.d)(I.a.sendUmsAction),Object(V.a)(({condition:e})=>this._apiService.sendUms(e).pipe(Object(W.a)(()=>({succeedYn:!0})),Object(N.a)(e=>Object(R.a)({succeedYn:!1,error:e})))),Object(k.a)(({succeedYn:e,error:t})=>{if(e){const e=[I.a.sendUmsSuccessAction()];this._runPage("Send mail successfully",e)}else this._catchErr(t,"Send mail failed")})),{dispatch:!1})}_runPage(e,t){this._alertService.alert({message:e,accept:(null==t?void 0:t.length)>0?()=>{t.forEach(e=>{this._store.dispatch(e)})}:()=>{}})}_catchErr(e,t,i){const n=this._errorService.errorHandler(e,t);E.isNil(n)||(E.isNil(n.accept)&&(n.accept=(null==i?void 0:i.length)>0?()=>{i.forEach(e=>{this._store.dispatch(e)})}:()=>{}),this._alertService.alert(n))}}return e.\u0275fac=function(t){return new(t||e)(A.bc(a.h),A.bc(S.a),A.bc(T.a),A.bc(s.a),A.bc(j))},e.\u0275prov=A.Mb({token:e,factory:e.\u0275fac}),e})(),U=(()=>{class e{}return e.\u0275mod=A.Ob({type:e}),e.\u0275inj=A.Nb({factory:function(t){return new(t||e)},imports:[[n.c,r.m,r.w,o.m,c.a,f.a,d.a,b.a,h.a,m.a,p.a,v.a,u.a,l.a,a.j.forFeature("sendEmailTemplate",g),s.b.forFeature([O])]]}),e})()},zhzn:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s}));const n=e=>{switch(e){case"KRW":return"\u20a9";case"USD":return"$";case"JPY":case"CNY":return"\xa5";case"VND":return"\u20ab";default:return""}},r=e=>{switch(e){case"KRW":return"kr";case"JPY":return"jp";case"VND":return"vi";default:return"kr"}},s=e=>{if(e.length<4)return e;const t=e.substring(0,e.length-4),i=e.substring(e.length-4,e.length);return t.replace(/[0-9]/g,"*")+i}}}]);