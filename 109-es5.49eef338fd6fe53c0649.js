function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{"2QGa":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var c=n("F97/"),i=n("SeVD"),a=n("pLZG"),r=n("HDdC");function o(t,e,n){return[Object(a.a)(e,n)(new r.a(Object(i.a)(t))),Object(a.a)(Object(c.a)(e,n))(new r.a(Object(i.a)(t)))]}},bgXO:function(t,e,n){"use strict";n.r(e),n.d(e,"CONTAINERS",(function(){return Ct})),n.d(e,"COMPONENTS",(function(){return kt})),n.d(e,"BsBatchLogModule",(function(){return xt}));var c={};n.r(c),n.d(c,"initBatchComponentStateAction",(function(){return L})),n.d(c,"loadBatchListAction",(function(){return C})),n.d(c,"loadBatchListSuccessAction",(function(){return k})),n.d(c,"loadBatchListFailureAction",(function(){return x})),n.d(c,"executeBatchAction",(function(){return _})),n.d(c,"executeBatchSuccessAction",(function(){return w})),n.d(c,"executeBatchFailureAction",(function(){return A}));var i=n("ofXK"),a=n("3Pt+"),r=n("snw9"),o=n("kt0X"),s=n("vu/V"),u=n("7rOj"),l=n("6LsY"),b=n("v7zA"),f=n("hHe4"),h=n("5hwk"),p=n("kKjH"),d=n("qXPF"),g=n("1OXJ"),v=n("7UZF"),O=n("l1P7"),m=n("w8np"),j=n("tyNb"),B=n("EVqC"),L=Object(o.o)("[BsBatchLog] init component state"),C=Object(o.o)("[BsBatchLog] load list"),k=Object(o.o)("[BsBatchLog] load list success",Object(o.t)()),x=Object(o.o)("[BsBatchLog] load list failure",Object(o.t)()),_=Object(o.o)("[BsBatchLog] execute batch",Object(o.t)()),w=Object(o.o)("[BsBatchLog] execute batch success"),A=Object(o.o)("[BsBatchLog] execute batch failure",Object(o.t)()),y=Object(B.a)({selectId:function(t){return t.batchCode},sortComparer:!1}).getInitialState({batchList:null,gridState:{pageInfo:{skip:0,take:20},sortInfo:[]}}),S=Object(o.q)(y,Object(o.s)(c.loadBatchListAction,(function(t){return Object.assign(Object.assign({},t),{loading:!0})})),Object(o.s)(c.loadBatchListSuccessAction,(function(t,e){var n=e.dataList;return Object.assign(Object.assign({},t),{batchList:n,loading:!1,gridState:{pageInfo:{skip:0,take:20},sortInfo:[]}})})),Object(o.s)(c.loadBatchListFailureAction,(function(t){return Object.assign(Object.assign({},t),{loading:!1})})),Object(o.s)(c.executeBatchAction,(function(t){return Object.assign(Object.assign({},t),{loading:!0})})),Object(o.s)(c.executeBatchSuccessAction,(function(t){return Object.assign(Object.assign({},t),{loading:!1})})),Object(o.s)(c.executeBatchFailureAction,(function(t){return Object.assign(Object.assign({},t),{loading:!1})})));function E(t,e){return Object(o.m)({BsBatchLogList:S})(t,e)}var I=Object(o.p)("bsBatchLog"),N=Object(o.r)(I,(function(t){return t.BsBatchLogList})),P=Object(o.r)(N,(function(t){return t.batchList}));Object(o.r)(N,(function(t){return t.gridState}));var F,T,V,$=n("LvDl"),G=n("XNiG"),W=n("fXoL"),Y=n("LRne"),R=n("z6cu"),U=n("eIep"),H=n("AytR"),X=H.a.API_URL,D={postBatchList:"".concat(X,"/admin/basis/batch-log")},M=n("tpT/"),J=H.a.API_URL,K=((T=function(){function t(e){_classCallCheck(this,t),this.api=e}return _createClass(t,[{key:"getBatchList",value:function(t){var e=$.assign({},this.api.defaultParams,{condition:t});return this.api.post(D.postBatchList,e).pipe(Object(U.a)((function(t){if(t.succeedYn&&t.result){var e=t.result;return Object(Y.a)(e)}return Object(R.a)(t||"api response error")})))}},{key:"excuteBatch",value:function(t){return this.api.get("".concat(J).concat(t)).pipe(Object(U.a)((function(t){return 200===t.status?Object(Y.a)(t):Object(R.a)(t||"api response error")})))}}]),t}()).\u0275fac=function(t){return new(t||T)(W.bc(M.a))},T.\u0275prov=W.Mb({token:T,factory:T.\u0275fac,providedIn:"root"}),T),Q=((F=_createClass((function t(e){_classCallCheck(this,t),this.fb=e,this.generateGridColumns=function(){return[{field:"autoYn",title:"Auto YN",width:75,template:"autoYnTpl"},{field:"startDatetime",title:"From ~ To Time",width:270,template:"executeTime"},{field:"manualActionName",title:"User",width:100},{field:"controlRemark",title:"Remark",width:200}]}}))).\u0275fac=function(t){return new(t||F)(W.bc(a.f))},F.\u0275prov=W.Mb({token:F,factory:F.\u0275fac,providedIn:"root"}),F),q=n("EsKh"),z=((V=function(){function t(e){_classCallCheck(this,t),this.alertService=e,this.exeEvent=new W.n}return _createClass(t,[{key:"ngOnInit",value:function(){}}]),t}()).\u0275fac=function(t){return new(t||V)(W.Qb(q.a))},V.\u0275cmp=W.Kb({type:V,selectors:[["app-bs-batch-log-control"]],inputs:{name:"name",url:"url",enableButton:"enableButton"},outputs:{exeEvent:"exeEvent"},decls:7,vars:2,consts:[[1,"grid-control-area"],[1,"form-label"],[1,"ml30","d-inline-flex","flex-glow-0"],[1,"ml-auto","d-inline-flex","flex-glow-0"],[1,"btn","btn-outline-dark","sm",2,"margin-right","10px",3,"disabled","click"]],template:function(t,e){1&t&&(W.Wb(0,"div",0),W.Wb(1,"span",1),W.Pc(2),W.Vb(),W.Rb(3,"div",2),W.Wb(4,"div",3),W.Wb(5,"button",4),W.fc("click",(function(){return e.exeEvent.emit(e.url)})),W.Pc(6,"Run"),W.Vb(),W.Vb(),W.Vb()),2&t&&(W.Cb(2),W.Qc(e.name),W.Cb(3),W.pc("disabled",!e.enableButton))},encapsulation:2,changeDetection:0}),V),Z=n("UIHd");function tt(t,e){1&t&&(W.Wb(0,"span"),W.Pc(1,"Y"),W.Vb())}function et(t,e){1&t&&(W.Wb(0,"span"),W.Pc(1,"N"),W.Vb())}function nt(t,e){if(1&t&&(W.Nc(0,tt,2,0,"span",11),W.Nc(1,et,2,0,"span",11)),2&t){var n=e.$implicit;W.pc("ngIf",!0===n.autoYn),W.Cb(1),W.pc("ngIf",!1===n.autoYn)}}function ct(t,e){if(1&t&&(W.Wb(0,"span"),W.Pc(1),W.Vb()),2&t){var n=e.$implicit;W.Cb(1),W.Sc("",n.startDatetime," ~ ",n.endDatetime,"")}}var it=function(){return{skip:0,take:20}},at=function(){return[]},rt=function(t,e){return{pageInfo:t,sortInfo:e}},ot=function(t,e){return{autoYnTpl:t,executeTime:e}};function st(t,e){if(1&t){var n=W.Xb();W.Ub(0),W.Wb(1,"div",6),W.Wb(2,"app-bs-batch-log-control",7),W.fc("exeEvent",(function(t){return W.Fc(n),W.hc(2).clickExecuteHandler(t)})),W.Vb(),W.Nc(3,nt,2,2,"ng-template",null,8,W.Oc),W.Nc(5,ct,2,2,"ng-template",null,9,W.Oc),W.Rb(7,"app-grid-simple",10),W.Vb(),W.Tb()}if(2&t){var c=e.$implicit,i=W.Ec(4),a=W.Ec(6),r=W.hc(2);W.Cb(2),W.pc("name",c.batchNameEn)("url",c.batchUrl)("enableButton",c.manualActionYn),W.Cb(5),W.Eb("grid-max-height-200"),W.pc("columns",r.columns)("gridState",W.vc(13,rt,W.tc(11,it),W.tc(12,at)))("hidePagination",!0)("dataList",c.logList)("templates",W.vc(16,ot,i,a))("isHiddenGridSetup",!0)}}function ut(t,e){if(1&t&&(W.Ub(0),W.Wb(1,"div",5),W.Nc(2,st,8,19,"ng-container",0),W.Vb(),W.Tb()),2&t){var n=e.$implicit;W.Cb(2),W.pc("ngForOf",n)}}var lt,bt,ft,ht,pt=function(t){return{display:t}},dt=((lt=function(){function t(e,n){_classCallCheck(this,t),this.store=e,this.dataService=n,this.batchGroupList=[],this.loading=!0,this._unsubscribe$=new G.a,this.loading=!0,this.batchList$=e.pipe(Object(o.u)(P)),this.columns=this.dataService.generateGridColumns()}return _createClass(t,[{key:"ngOnInit",value:function(){this.store.dispatch(c.loadBatchListAction())}},{key:"ngAfterContentInit",value:function(){this._initSubscription()}},{key:"ngOnDestroy",value:function(){this._unsubscribe$.next(),this._unsubscribe$.complete()}},{key:"clickExecuteHandler",value:function(t){this.store.dispatch(c.executeBatchAction({batchUrl:t}))}},{key:"_initSubscription",value:function(){var t=this;this.batchList$.subscribe((function(e){$.isNil(e)||(t.batchGroupList=t._convertToGroupList(e),console.log(t.batchGroupList),t.loading=!1)}))}},{key:"_convertToGroupList",value:function(t){return t.reduce((function(t,e,n){var c=Math.floor(n/3);return $.isNil(t[c])&&t.push([]),t[c].push(e),t}),[])}}]),t}()).\u0275fac=function(t){return new(t||lt)(W.Qb(o.h),W.Qb(Q))},lt.\u0275cmp=W.Kb({type:lt,selectors:[["app-bs-batch-log"]],decls:6,vars:4,consts:[[4,"ngFor","ngForOf"],[2,"position","absolute","top","50%","left","50%",3,"ngStyle"],[1,"content-loading","align-items-center"],[1,"icon-loading","lg"],[1,"loading-title"],[1,"frame-wrap","basis-3",2,"margin-top","24px"],[1,"frame"],[3,"name","url","enableButton","exeEvent"],["autoYnTpl",""],["executeTime",""],[3,"columns","gridState","hidePagination","dataList","templates","isHiddenGridSetup"],[4,"ngIf"]],template:function(t,e){1&t&&(W.Nc(0,ut,3,1,"ng-container",0),W.Wb(1,"div",1),W.Wb(2,"div",2),W.Rb(3,"div",3),W.Wb(4,"div",4),W.Pc(5,"loading..."),W.Vb(),W.Vb(),W.Vb()),2&t&&(W.pc("ngForOf",e.batchGroupList),W.Cb(1),W.pc("ngStyle",W.uc(2,pt,e.loading?"flex":"none")))},directives:[i.n,i.p,z,Z.a,i.o],encapsulation:2}),lt),gt=[{path:"",component:dt,data:{title:"Batch Log"}}],vt=((bt=_createClass((function t(){_classCallCheck(this,t)}))).\u0275mod=W.Ob({type:bt}),bt.\u0275inj=W.Nb({factory:function(t){return new(t||bt)},imports:[[j.f.forChild(gt)],j.f]}),bt),Ot=n("lJxs"),mt=n("JIr8"),jt=n("vkgz"),Bt=n("Xb6A"),Lt=((ft=function(){function t(e,n,i,a,o){var s=this;_classCallCheck(this,t),this.actions$=e,this.service=n,this._errorService=i,this.store=a,this.alertService=o,this.loadBatchList$=Object(r.c)((function(){return s.actions$.pipe(Object(r.d)(c.loadBatchListAction),Object(U.a)((function(){return s.service.getBatchList({}).pipe(Object(Ot.a)((function(t){return c.loadBatchListSuccessAction({dataList:t})})),Object(mt.a)((function(t){var e="\ubc30\uce58 \ub9ac\uc2a4\ud2b8 \uc870\ud68c\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4.",n=[c.loadBatchListFailureAction({error:e})];return s._catchErr(t,e,n),[]})))})))})),this.executeBatch$=Object(r.c)((function(){return s.actions$.pipe(Object(r.d)(c.executeBatchAction),Object(U.a)((function(t){var e=t.batchUrl;return s.service.excuteBatch(e).pipe(Object(Ot.a)((function(){return{succeedYn:!0}})))})),Object(jt.a)((function(t){var e=t.succeedYn,n=t.error;if(e){var i=[c.loadBatchListAction()];s._runPage("\ubc30\uce58\uac00 \uc2e4\ud589\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",i)}else{var a=[c.executeBatchFailureAction({error:"\uc608\uc57d\ub9e4\ud551 \ucde8\uc18c\ub97c \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."})];s._catchErr(n,"\ubc30\uce58\uac00 \uc2e4\ud589\ub418\uc9c0 \ubabb\ud558\uc600\uc2b5\ub2c8\ub2e4.",a)}})))}),{dispatch:!1})}return _createClass(t,[{key:"_runPage",value:function(t,e){var n=this;this.alertService.alert({message:t,accept:(null==e?void 0:e.length)>0?function(){e.forEach((function(t){n.store.dispatch(t)}))}:function(){}})}},{key:"_catchErr",value:function(t,e,n){var c=this,i=this._errorService.errorHandler(t,e);$.isNil(i)||($.isNil(i.accept)&&(i.accept=(null==n?void 0:n.length)>0?function(){n.forEach((function(t){c.store.dispatch(t)}))}:function(){}),this.alertService.alert(i))}}]),t}()).\u0275fac=function(t){return new(t||ft)(W.bc(r.a),W.bc(K),W.bc(Bt.a),W.bc(o.h),W.bc(q.a))},ft.\u0275prov=W.Mb({token:ft,factory:ft.\u0275fac}),ft),Ct=[dt],kt=[z],xt=((ht=_createClass((function t(){_classCallCheck(this,t)}))).\u0275mod=W.Ob({type:ht}),ht.\u0275inj=W.Nb({factory:function(t){return new(t||ht)},imports:[[i.c,a.m,a.w,s.a,u.a,b.a,l.a,f.a,h.a,p.a,d.a,g.a,v.a,O.a,m.a,vt,o.j.forFeature("bsBatchLog",E),r.b.forFeature([Lt])]]}),ht)}}]);