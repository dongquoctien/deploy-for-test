(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{EfGc:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var o=n("fXoL"),a=n("LvDl"),l=n("wd/R"),i=n("XNiG"),c=n("2Vo4"),r=n("5To1"),s=n("kt0X"),b=n("0qeV"),u=n("ofXK"),d=n("Onn4");function h(e,t){if(1&e){const e=o.Xb();o.Wb(0,"div",14),o.Wb(1,"app-radio",15),o.fc("onClick",(function(){return o.Fc(e),o.hc().changeLocalAllotmentYn(!0)})),o.Vb(),o.Wb(2,"app-radio",16),o.fc("onClick",(function(){return o.Fc(e),o.hc().changeLocalAllotmentYn(!1)})),o.Vb(),o.Vb()}2&e&&(o.Cb(1),o.pc("checked",!0)("value",!0),o.Cb(1),o.pc("value",!1))}function p(e,t){if(1&e&&(o.Wb(0,"div",20),o.Pc(1),o.Vb()),2&e){const e=o.hc().$implicit;o.Cb(1),o.Qc(e.day)}}function m(e,t){if(1&e&&o.Sb(0,22),2&e){const e=o.hc().$implicit;o.pc("ngComponentOutlet",null==e?null:e.component)("ngComponentOutletInjector",null==e?null:e.injector)}}function f(e,t){if(1&e&&(o.Ub(0),o.Nc(1,m,1,2,"ng-container",21),o.Tb()),2&e){const e=t.$implicit,n=o.hc().$implicit;o.Cb(1),o.pc("ngIf",(null==e?null:e.date)===(null==n?null:n.date))}}function v(e,t){if(1&e&&(o.Wb(0,"div",23),o.Pc(1),o.Vb()),2&e){const e=o.hc().$implicit,t=o.hc(2);o.Cb(1),o.Rc("",t.getText(t.subTextDatas,t.leftMonth.year,t.leftMonth.month,e.day)," ")}}function y(e,t){if(1&e&&(o.Wb(0,"div",23),o.Pc(1),o.Vb()),2&e){const e=t.ngIf,n=o.hc().$implicit,a=o.hc(2);o.Cb(1),o.Rc(" ",a.getDateContents(e,a.leftMonth.year,a.leftMonth.month,n.day)," ")}}const g=function(e,t,n){return{sun:e,sat:t,on:n}};function C(e,t){if(1&e){const e=o.Xb();o.Ub(0),o.Wb(1,"td",17),o.fc("click",(function(){o.Fc(e);const n=t.$implicit;return o.hc(2).selectDay(n)})),o.Nc(2,p,2,1,"div",18),o.Nc(3,f,2,1,"ng-container",10),o.ic(4,"async"),o.Nc(5,v,2,1,"div",19),o.Nc(6,y,2,1,"div",19),o.ic(7,"async"),o.Vb(),o.Tb()}if(2&e){const e=t.$implicit,n=o.hc(2);o.Cb(1),o.Gb("unavailable",!n.selectableDay(e)),o.pc("ngClass",o.wc(11,g,1===(null==e?null:e.weekdayNo),7===(null==e?null:e.weekdayNo),null==e?null:e.selected)),o.Cb(1),o.pc("ngIf",e.day),o.Cb(1),o.pc("ngForOf",o.jc(4,7,n.dateContents$)),o.Cb(2),o.pc("ngIf",n.subTextDatas),o.Cb(1),o.pc("ngIf",o.jc(7,9,n.dateContents$))}}function V(e,t){if(1&e&&(o.Wb(0,"tr"),o.Nc(1,C,8,15,"ng-container",10),o.Vb()),2&e){const e=t.$implicit;o.Cb(1),o.pc("ngForOf",e)}}function D(e,t){if(1&e&&(o.Wb(0,"div",20),o.Pc(1),o.Vb()),2&e){const e=o.hc().$implicit;o.Cb(1),o.Qc(e.day)}}function W(e,t){if(1&e&&(o.Wb(0,"div",23),o.Pc(1),o.Vb()),2&e){const e=o.hc().$implicit,t=o.hc(2);o.Cb(1),o.Rc("",t.getText(t.subTextDatas,t.centerMonth.year,t.centerMonth.month,e.day)," ")}}function P(e,t){if(1&e&&(o.Wb(0,"div",23),o.Pc(1),o.Vb()),2&e){const e=t.ngIf,n=o.hc().$implicit,a=o.hc(2);o.Cb(1),o.Rc(" ",a.getDateContents(e,a.centerMonth.year,a.centerMonth.month,n.day)," ")}}function k(e,t){if(1&e){const e=o.Xb();o.Ub(0),o.Wb(1,"td",17),o.fc("click",(function(){o.Fc(e);const n=t.$implicit;return o.hc(2).selectDay(n)})),o.Nc(2,D,2,1,"div",18),o.Nc(3,W,2,1,"div",19),o.Nc(4,P,2,1,"div",19),o.ic(5,"async"),o.Vb(),o.Tb()}if(2&e){const e=t.$implicit,n=o.hc(2);o.Cb(1),o.Gb("unavailable",!n.selectableDay(e)),o.pc("ngClass",o.wc(8,g,1===(null==e?null:e.weekdayNo),7===(null==e?null:e.weekdayNo),null==e?null:e.selected)),o.Cb(1),o.pc("ngIf",e.day),o.Cb(1),o.pc("ngIf",n.subTextDatas),o.Cb(1),o.pc("ngIf",o.jc(5,6,n.dateContents$))}}function Y(e,t){if(1&e&&(o.Wb(0,"tr"),o.Nc(1,k,6,12,"ng-container",10),o.Vb()),2&e){const e=t.$implicit;o.Cb(1),o.pc("ngForOf",e)}}function S(e,t){if(1&e&&(o.Wb(0,"div",20),o.Pc(1),o.Vb()),2&e){const e=o.hc().$implicit;o.Cb(1),o.Qc(e.day)}}function I(e,t){if(1&e&&(o.Wb(0,"div",23),o.Pc(1),o.Vb()),2&e){const e=o.hc().$implicit,t=o.hc(2);o.Cb(1),o.Rc("",t.getText(t.subTextDatas,t.rightMonth.year,t.rightMonth.month,e.day)," ")}}function R(e,t){if(1&e&&(o.Wb(0,"div",23),o.Pc(1),o.Vb()),2&e){const e=t.ngIf,n=o.hc().$implicit,a=o.hc(2);o.Cb(1),o.Rc(" ",a.getDateContents(e,a.rightMonth.year,a.rightMonth.month,n.day)," ")}}function M(e,t){if(1&e){const e=o.Xb();o.Ub(0),o.Wb(1,"td",17),o.fc("click",(function(){o.Fc(e);const n=t.$implicit;return o.hc(2).selectDay(n)})),o.Nc(2,S,2,1,"div",18),o.Nc(3,I,2,1,"div",19),o.Nc(4,R,2,1,"div",19),o.ic(5,"async"),o.Vb(),o.Tb()}if(2&e){const e=t.$implicit,n=o.hc(2);o.Cb(1),o.Gb("unavailable",!n.selectableDay(e)),o.pc("ngClass",o.wc(8,g,1===(null==e?null:e.weekdayNo),7===(null==e?null:e.weekdayNo),null==e?null:e.selected)),o.Cb(1),o.pc("ngIf",e.day),o.Cb(1),o.pc("ngIf",n.subTextDatas),o.Cb(1),o.pc("ngIf",o.jc(5,6,n.dateContents$))}}function T(e,t){if(1&e&&(o.Wb(0,"tr"),o.Nc(1,M,6,12,"ng-container",10),o.Vb()),2&e){const e=t.$implicit;o.Cb(1),o.pc("ngForOf",e)}}function F(e,t){if(1&e){const e=o.Xb();o.Wb(0,"button",24),o.fc("click",(function(){return o.Fc(e),o.hc().onSubmit()})),o.Pc(1," Select "),o.Vb()}if(2&e){const e=o.hc();o.pc("disabled",0===e.selectedDays.length)}}let N=(()=>{class e{constructor(e,t,n){this.calendarService=e,this.store=t,this.service=n,this.submitEvent=new o.n,this.closeEvent=new o.n,this.monthName=["","January","February","March","April","May","June","July","August","September","October","November","December"],this.selectedDays=[],this.currentLeftMonth=0,this.localAllotmentYn=!0,this.unsubscribe$=new i.a,this.dateContents$=new c.a([]),this.currentLeftMonth=l().month()+1,this.currentYear=l().year()}ngOnInit(){this.setCalendar(),this.minDate&&(this.currentYear=this.minDate.year,this.currentLeftMonth=this.minDate.month,this.setCalendar())}ngOnChanges(e){var t,n;e.validDateRange&&(null===(t=e.validDateRange)||void 0===t?void 0:t.currentValue)&&(this.validDateRange=null===(n=e.validDateRange)||void 0===n?void 0:n.currentValue)}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}getAllotment3Month(){const e=`${this.leftMonth.year}${String(this.leftMonth.month).padStart(2,"0")}`;this.service.loadAllotment3month(Object.assign({fromYearMonth:e},this.allotmentParameters)).subscribe(e=>{this.dateContents$.next(e.list)})}setCalendar(){const e=l([this.currentYear,this.currentLeftMonth-1]).add(1,"M"),t=l([this.currentYear,this.currentLeftMonth-1]).add(2,"M");this.leftMonth=this.calendarService.getMonth(this.currentLeftMonth,this.currentYear),this.centerMonth=this.calendarService.getMonth(e.month()+1,e.year()),this.rightMonth=this.calendarService.getMonth(t.month()+1,t.year()),this.isPreview&&!a.isNil(this.allotmentParameters)&&this.getAllotment3Month()}onSubmit(){this.selectedDays.sort(),this.submitEvent.emit(this.selectedDays),this.closeEvent.emit()}onClose(){this.closeEvent.emit()}getPrev(){this.currentLeftMonth-=3,this.currentLeftMonth<=0&&(this.currentLeftMonth=12+this.currentLeftMonth,this.currentYear-=1),this.setCalendar()}getNext(){this.currentLeftMonth+=3,this.currentLeftMonth>12&&(this.currentLeftMonth-=12,this.currentYear+=1),this.setCalendar()}selectDay(e){if(!e.selectableYn||this.isPreview)return;if(!this.selectableDay(e))return;e.selected=!e.selected;const t=`${e.year}-${("0"+e.month).slice(-2)}-${("0"+e.day).slice(-2)}`;e.selected?this.selectedDays.push(t):a.remove(this.selectedDays,e=>e===t)}getDateContents(e,t,n,o){let a=[];1===e.length?a=e[0].allotments:2===e.length&&(a=e.find(e=>e.localAllotmentYn===this.localAllotmentYn).allotments);const l=null==a?void 0:a.find(e=>e.appliedYear===t&&e.appliedMonth===n&&e.appliedDay===o);return l&&`${l.leftCountSum}/${l.allotmentCountSum}`}changeLocalAllotmentYn(e){this.localAllotmentYn=e}getText(e,t,n,o){const l=a.find(e,{year:t,month:n,day:o});return null==l?void 0:l.text}selectableDay(e){if(null==this.validDateRange)return!0;if(!e.selectableYn)return!1;let t=!1;return this.validDateRange.forEach(n=>{const o=l(`${e.year}-${e.month}-${e.day}`,"YYYY-M-D");0==t&&(t=o.isBetween(n.firstDate,n.lastDate,void 0,"[]"))}),t}}return e.\u0275fac=function(t){return new(t||e)(o.Qb(r.a),o.Qb(s.h),o.Qb(b.a))},e.\u0275cmp=o.Kb({type:e,selectors:[["app-calendar-view"]],inputs:{isPreview:"isPreview",allotmentParameters:"allotmentParameters",minDate:"minDate",subTextDatas:"subTextDatas",validDateRange:"validDateRange"},outputs:{submitEvent:"submitEvent",closeEvent:"closeEvent"},features:[o.Ab],decls:113,vars:13,consts:[["class","form-group",4,"ngIf"],[1,"preview-calendar-wrap"],["title","\uc774\uc804\ub2ec",1,"btn-prev-month",3,"click"],["title","\ub2e4\uc74c\ub2ec",1,"btn-next-month",3,"click"],[1,"preview-calendar"],[1,"calendar-header"],[1,"calendar-body"],["scope","col",1,"sun"],["scope","col"],["scope","col",1,"sat"],[4,"ngFor","ngForOf"],[1,"button-area","align-r","mt10"],["class","btn btn-secondary sm",3,"disabled","click",4,"ngIf"],[1,"btn","btn-light","sm",3,"click"],[1,"form-group"],["name","localAllotmentYn","label","OMH",3,"checked","value","onClick"],["name","localAllotmentYn","label","CMS",3,"value","onClick"],[3,"ngClass","click"],["class","day",4,"ngIf"],["class","preview-day",4,"ngIf"],[1,"day"],[3,"ngComponentOutlet","ngComponentOutletInjector",4,"ngIf"],[3,"ngComponentOutlet","ngComponentOutletInjector"],[1,"preview-day"],[1,"btn","btn-secondary","sm",3,"disabled","click"]],template:function(e,t){1&e&&(o.Nc(0,h,3,3,"div",0),o.ic(1,"async"),o.Wb(2,"div",1),o.Wb(3,"a",2),o.fc("click",(function(){return t.getPrev()})),o.Pc(4,"\uc774\uc804\ub2ec"),o.Vb(),o.Wb(5,"a",3),o.fc("click",(function(){return t.getNext()})),o.Pc(6,"\ub2e4\uc74c\ub2ec"),o.Vb(),o.Wb(7,"div",4),o.Wb(8,"h1",5),o.Wb(9,"strong"),o.Pc(10),o.Vb(),o.Vb(),o.Wb(11,"div",6),o.Wb(12,"table"),o.Wb(13,"caption"),o.Pc(14," Calendar "),o.Vb(),o.Wb(15,"colgroup"),o.Rb(16,"col"),o.Rb(17,"col"),o.Rb(18,"col"),o.Rb(19,"col"),o.Rb(20,"col"),o.Rb(21,"col"),o.Rb(22,"col"),o.Vb(),o.Wb(23,"thead"),o.Wb(24,"tr"),o.Wb(25,"th",7),o.Pc(26,"Sun"),o.Vb(),o.Wb(27,"th",8),o.Pc(28,"Mon"),o.Vb(),o.Wb(29,"th",8),o.Pc(30,"Tue"),o.Vb(),o.Wb(31,"th",8),o.Pc(32,"Wed"),o.Vb(),o.Wb(33,"th",8),o.Pc(34,"Thu"),o.Vb(),o.Wb(35,"th",8),o.Pc(36,"Fri"),o.Vb(),o.Wb(37,"th",9),o.Pc(38,"Sat"),o.Vb(),o.Vb(),o.Vb(),o.Wb(39,"tbody"),o.Nc(40,V,2,1,"tr",10),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Wb(41,"div",4),o.Wb(42,"h1",5),o.Wb(43,"strong"),o.Pc(44),o.Vb(),o.Vb(),o.Wb(45,"div",6),o.Wb(46,"table"),o.Wb(47,"caption"),o.Pc(48," Calendar "),o.Vb(),o.Wb(49,"colgroup"),o.Rb(50,"col"),o.Rb(51,"col"),o.Rb(52,"col"),o.Rb(53,"col"),o.Rb(54,"col"),o.Rb(55,"col"),o.Rb(56,"col"),o.Vb(),o.Wb(57,"thead"),o.Wb(58,"tr"),o.Wb(59,"th",7),o.Pc(60,"Sun"),o.Vb(),o.Wb(61,"th",8),o.Pc(62,"Mon"),o.Vb(),o.Wb(63,"th",8),o.Pc(64,"Tue"),o.Vb(),o.Wb(65,"th",8),o.Pc(66,"Wed"),o.Vb(),o.Wb(67,"th",8),o.Pc(68,"Thu"),o.Vb(),o.Wb(69,"th",8),o.Pc(70,"Fri"),o.Vb(),o.Wb(71,"th",9),o.Pc(72,"Sat"),o.Vb(),o.Vb(),o.Vb(),o.Wb(73,"tbody"),o.Nc(74,Y,2,1,"tr",10),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Wb(75,"div",4),o.Wb(76,"h1",5),o.Wb(77,"strong"),o.Pc(78),o.Vb(),o.Vb(),o.Wb(79,"div",6),o.Wb(80,"table"),o.Wb(81,"caption"),o.Pc(82," Calendar "),o.Vb(),o.Wb(83,"colgroup"),o.Rb(84,"col"),o.Rb(85,"col"),o.Rb(86,"col"),o.Rb(87,"col"),o.Rb(88,"col"),o.Rb(89,"col"),o.Rb(90,"col"),o.Vb(),o.Wb(91,"thead"),o.Wb(92,"tr"),o.Wb(93,"th",7),o.Pc(94,"Sun"),o.Vb(),o.Wb(95,"th",8),o.Pc(96,"Mon"),o.Vb(),o.Wb(97,"th",8),o.Pc(98,"Tue"),o.Vb(),o.Wb(99,"th",8),o.Pc(100,"Wed"),o.Vb(),o.Wb(101,"th",8),o.Pc(102,"Thu"),o.Vb(),o.Wb(103,"th",8),o.Pc(104,"Fri"),o.Vb(),o.Wb(105,"th",9),o.Pc(106,"Sat"),o.Vb(),o.Vb(),o.Vb(),o.Wb(107,"tbody"),o.Nc(108,T,2,1,"tr",10),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Wb(109,"div",11),o.Nc(110,F,2,1,"button",12),o.Wb(111,"button",13),o.fc("click",(function(){return t.onClose()})),o.Pc(112,"Close"),o.Vb(),o.Vb()),2&e&&(o.pc("ngIf",o.jc(1,11,t.dateContents$).length>1),o.Cb(10),o.Sc("",t.monthName[null==t.leftMonth?null:t.leftMonth.month]," ",null==t.leftMonth?null:t.leftMonth.year,""),o.Cb(30),o.pc("ngForOf",null==t.leftMonth?null:t.leftMonth.days),o.Cb(4),o.Sc("",t.monthName[null==t.centerMonth?null:t.centerMonth.month]," ",null==t.centerMonth?null:t.centerMonth.year,""),o.Cb(30),o.pc("ngForOf",null==t.centerMonth?null:t.centerMonth.days),o.Cb(4),o.Sc("",t.monthName[null==t.rightMonth?null:t.rightMonth.month]," ",null==t.rightMonth?null:t.rightMonth.year,""),o.Cb(30),o.pc("ngForOf",null==t.rightMonth?null:t.rightMonth.days),o.Cb(2),o.pc("ngIf",!t.isPreview))},directives:[u.o,u.n,d.a,u.l,u.m],pipes:[u.b],encapsulation:2,changeDetection:0}),e})()},VIhy:function(e,t,n){"use strict";n.d(t,"a",(function(){return W}));var o=n("ofXK"),a=n("3Pt+"),l=n("pxUr"),i=n("WG3B"),c=n("wPo9"),r=n("7rOj"),s=n("l1P7"),b=n("v7zA"),u=n("7UZF"),d=n("hHe4"),h=n("1OXJ"),p=n("5hwk"),m=n("px/L"),f=n("6LsY"),v=n("kKjH"),y=n("vu/V"),g=n("tyNb"),C=n("fXoL");const V=[];let D=(()=>{class e{}return e.\u0275mod=C.Ob({type:e}),e.\u0275inj=C.Nb({factory:function(t){return new(t||e)},imports:[[g.f.forChild(V)],g.f]}),e})(),W=(()=>{class e{}return e.\u0275mod=C.Ob({type:e}),e.\u0275inj=C.Nb({factory:function(t){return new(t||e)},imports:[[o.c,a.m,a.w,l.a,i.m,c.a,r.a,p.a,s.a,b.a,u.a,d.a,h.a,v.a,y.a,m.a,f.a,D]]}),e})()},pybq:function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));var o=n("fXoL"),a=n("LvDl"),l=n("XNiG"),i=n("wd/R"),c=n.n(i),r=n("3Pt+");let s=(()=>{class e{constructor(e){this.fb=e,this.generateAllotmentPutForm=()=>this.fb.group({hotelContractSeq:[null,[r.z.required]],localAllotmentYn:[!1,[r.z.required]],sellerCompCode:[0,[r.z.required]],allotmentCmsPmsCompCode:[null],allotmentPeriod:this.fb.group({periods:this.fb.array([this.generatePeriodGroups()]),includeDates:[],excludeDates:[]}),roomTypes:this.fb.array([]),dailySalesStopYn:[!1]}),this.generateRoomTypeGroups=()=>this.fb.group({addQuantity:[null,[r.z.required]],minNights:[1,[r.z.required]],vendorRoomTypeSeq:[null,[r.z.required]],salesStopYn:[!1,[r.z.required]],roomTypeNameEn:null}),this.generatePeriodGroups=()=>this.fb.group({appliedFromDate:[null],appliedToDate:[null],appliedMonYn:[!0],appliedTueYn:[!0],appliedWedYn:[!0],appliedThuYn:[!0],appliedFriYn:[!0],appliedSatYn:[!0],appliedSunYn:[!0]},{validators:this.compareDatesValidators("dateRangeCompare",["appliedFromDate","appliedToDate"])})}compareDatesValidators(e,t){return n=>{if(!n)return null;const o=n,l=t.length,i=t.map(e=>o.get(e).value);let r=!1;return i.forEach((e,t)=>{if(!r&&t+1<l){const n=i[t+1];r=a.isNil(e)||a.isNil(n)?!a.isNil(e)||!a.isNil(n):c()(n).isBefore(c()(e))}}),r?{[e]:!0}:null}}}return e.\u0275fac=function(t){return new(t||e)(o.bc(r.f))},e.\u0275prov=o.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=n("EsKh"),u=n("xDUJ"),d=n("ofXK"),h=n("Onn4"),p=n("rbKv"),m=n("kd+X"),f=n("LVFn"),v=n("pb6r"),y=n("gbCm");const g=function(e){return["allotmentPeriod","periods",e]},C=function(e,t){return{"fa-plus":e,"fa-minus":t}};function V(e,t){if(1&e){const e=o.Xb();o.Wb(0,"div",29),o.Ub(1,30),o.Wb(2,"div",31),o.Rb(3,"mat-datepicker-toggle",32),o.Rb(4,"input",33),o.Rb(5,"mat-datepicker",null,34),o.Vb(),o.Wb(7,"div",35),o.Pc(8,"~"),o.Vb(),o.Wb(9,"div",36),o.Rb(10,"mat-datepicker-toggle",32),o.Rb(11,"input",37),o.Rb(12,"mat-datepicker",null,38),o.Vb(),o.Wb(14,"app-checkbox",39),o.fc("onChange",(function(n){o.Fc(e);const a=t.index;return o.hc(2).onDayCheckAll(n,a)})),o.Vb(),o.Wb(15,"app-checkbox",40),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(16,"app-checkbox",41),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(17,"app-checkbox",42),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(18,"app-checkbox",43),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(19,"app-checkbox",44),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(20,"app-checkbox",45),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(21,"app-checkbox",46),o.fc("onChange",(function(t){return o.Fc(e),o.hc(2).onDayCheck(t)})),o.Vb(),o.Wb(22,"button",47),o.fc("click",(function(){o.Fc(e);const n=t.index;return o.hc(2).addRemovePeriod(n)})),o.Rb(23,"i",48),o.Vb(),o.Tb(),o.Vb()}if(2&e){const e=t.index,n=o.Ec(6),a=o.Ec(13),l=o.hc(2);o.Cb(1),o.qc("formGroupName",e),o.Cb(1),o.Gb("valid-error",l.checkIsInvalid(o.uc(11,g,e))),o.Cb(1),o.pc("for",n),o.Cb(1),o.pc("matDatepicker",n),o.Cb(5),o.Gb("valid-error",l.checkIsInvalid(o.uc(13,g,e))),o.Cb(1),o.pc("for",a),o.Cb(1),o.pc("matDatepicker",a),o.Cb(3),o.pc("value",l.isAllDayChecked),o.Cb(9),o.pc("ngClass",o.vc(15,C,0==e,e>0))}}function D(e,t){if(1&e&&(o.Wb(0,"tr"),o.Wb(1,"th",9),o.Pc(2,"Period"),o.Vb(),o.Wb(3,"td"),o.Ub(4,27),o.Nc(5,V,24,18,"div",28),o.Tb(),o.Vb(),o.Vb()),2&e){const e=o.hc();o.Cb(5),o.pc("ngForOf",e.periodArray.controls)}}function W(e,t){if(1&e){const e=o.Xb();o.Wb(0,"button",49),o.fc("click",(function(){return o.Fc(e),o.hc().showCalendar("include")})),o.Pc(1," Select Date "),o.Vb()}}function P(e,t){if(1&e){const e=o.Xb();o.Wb(0,"button",50),o.fc("click",(function(){return o.Fc(e),o.hc().resetIncludeDates()})),o.Pc(1," Reset Date "),o.Vb()}}function k(e,t){if(1&e){const e=o.Xb();o.Wb(0,"tr"),o.Wb(1,"th",9),o.Pc(2," Exclude Days "),o.Wb(3,"button",49),o.fc("click",(function(){return o.Fc(e),o.hc().showCalendar("exclude")})),o.Pc(4," Select Date "),o.Vb(),o.Wb(5,"button",50),o.fc("click",(function(){return o.Fc(e),o.hc().resetExcludeDates()})),o.Pc(6," Reset Date "),o.Vb(),o.Vb(),o.Wb(7,"td"),o.Wb(8,"div",12),o.Rb(9,"textarea",51),o.Vb(),o.Vb(),o.Vb()}}function Y(e,t){if(1&e){const e=o.Xb();o.Wb(0,"app-checkbox",52),o.fc("onChange",(function(t){return o.Fc(e),o.hc().onRoomCheckAll(t)})),o.Vb()}2&e&&o.pc("label","All")}const S=function(){return{standalone:!0}};function I(e,t){if(1&e){const e=o.Xb();o.Wb(0,"li"),o.Wb(1,"app-checkbox",53),o.fc("ngModelChange",(function(t){return o.Fc(e),o.hc().checkedRoomList=t}))("onChange",(function(n){o.Fc(e);const a=t.$implicit;return o.hc().onRoomCheck(n,a)})),o.Vb(),o.Vb()}if(2&e){const e=t.$implicit,n=o.hc();o.Cb(1),o.pc("ngModel",n.checkedRoomList)("value",e.vendorRoomTypeSeq)("label",n.roomTypeLabel(e))("ngModelOptions",o.tc(5,S))("disabled",n.isImmutableIncludeDays)}}const R=function(e){return["roomTypes",e,"addQuantity"]};function M(e,t){if(1&e){const e=o.Xb();o.Wb(0,"tr"),o.Ub(1,30),o.Wb(2,"td"),o.Pc(3),o.Vb(),o.Wb(4,"td"),o.Rb(5,"app-input-text",54),o.Vb(),o.Wb(6,"td"),o.Wb(7,"button",55),o.fc("click",(function(){o.Fc(e);const n=t.index;return o.hc().showCalendarPreview(n)})),o.Pc(8," Preview "),o.Vb(),o.Vb(),o.Tb(),o.Vb()}if(2&e){const e=t.$implicit,n=t.index,a=o.hc();o.Cb(1),o.qc("formGroupName",n),o.Cb(2),o.Qc(e.value.roomTypeNameEn),o.Cb(2),o.pc("isInvalid",a.checkIsInvalid(o.uc(3,R,n)))}}function T(e,t){1&e&&(o.Wb(0,"p",56),o.Pc(1," No selected item. "),o.Vb())}let F=(()=>{class e{constructor(e,t,n){this._dataService=e,this.alertService=t,this.formService=n,this.isImmutableIncludeDays=!1,this.openCalendarEvent=new o.n,this.submitEvent=new o.n,this.closeEvent=new o.n,this._leftCountSum=0,this.unsubscribe$=new l.a,this.isAllDayChecked=!0,this.checkedRoomList=[],this.upsertForm=this._dataService.generateAllotmentPutForm()}get periodArray(){return this.upsertForm.get("allotmentPeriod").get("periods")}get roomTypeArray(){return this.upsertForm.get("roomTypes")}periodGroup(e){return this.periodArray.at(e)}roomTypeGroup(e){return this.roomTypeArray.at(e)}ngOnInit(){var e,t;const n=null===(e=this.checkedDateInfo[0])||void 0===e?void 0:e.rooms[0],o=!!(null==n?void 0:n.params.salesStopYn)&&(null==n?void 0:n.params.salesStopYn);if(this.upsertForm.get("dailySalesStopYn").patchValue(o),this.isImmutableIncludeDays){let e=this._dataService.generateRoomTypeGroups();e.get("vendorRoomTypeSeq").patchValue(null==n?void 0:n.roomId);const o=this.roomList.find(e=>e.vendorRoomTypeSeq===(null==n?void 0:n.roomId)),a=null==o?void 0:o.roomTypeNameEn;this._leftCountSum=null===(t=null==n?void 0:n.params)||void 0===t?void 0:t.leftCountSum,e.get("roomTypeNameEn").patchValue(a),e.get("addQuantity").patchValue(0),e.get("minNights").patchValue(1),this.roomTypeArray.push(e),this.checkedRoomList.push(null==n?void 0:n.roomId),this.roomList=[o]}}ngOnChanges(e){var t,n,o,a,l,i,c,r,s;if(!e.includeDays||!this.isImmutableIncludeDays&&(null===(t=e.includeDays)||void 0===t?void 0:t.firstChange)){if(e.excludeDays&&!(null===(o=e.excludeDays)||void 0===o?void 0:o.firstChange)){const t=null===(a=e.excludeDays)||void 0===a?void 0:a.currentValue;if(t){const e=t.filter(e=>!this.includeDays.includes(e)||(this.alertService.alert("Include date and Exclude date cannot be overlapped"),!1));this.upsertForm.get("allotmentPeriod").get("excludeDates").setValue(e)}else this.upsertForm.get("allotmentPeriod").get("excludeDates").setValue([])}}else this.upsertForm.get("allotmentPeriod").get("includeDates").setValue(null===(n=e.includeDays)||void 0===n?void 0:n.currentValue);e.checkedDateInfo&&(this.contractData?(this.upsertForm.get("hotelContractSeq").patchValue(this.contractData.hotelContractSeq),this.upsertForm.get("localAllotmentYn").patchValue(null!==(l=this.contractData.localAllotmentYn)&&void 0!==l&&l)):(this.upsertForm.get("hotelContractSeq").patchValue(null===(i=this.checkedDateInfo[0])||void 0===i?void 0:i.hotelContractSeq),this.upsertForm.get("localAllotmentYn").patchValue(null!==(s=null===(r=null===(c=this.checkedDateInfo[0])||void 0===c?void 0:c.rooms[0])||void 0===r?void 0:r.params.localAllotmentYn)&&void 0!==s&&s)))}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}onSubmit(){if(this._v_isDateConditionFilled()||this.alertService.alert("Please fill the date condition."),this.upsertForm.invalid&&!this.isImmutableIncludeDays||!this._v_isDateConditionFilled())return void(this.checkValid=!0);const e=a.cloneDeep(this.upsertForm.getRawValue());e.roomTypes.forEach(t=>{t.salesStopYn=e.dailySalesStopYn,delete t.roomTypeNameEn}),this.isImmutableIncludeDays&&delete e.allotmentPeriod.periods,this.formService.cleanUpWithArray(e,["dailySalesStopYn"]),this.submitEvent.emit(e)}onClose(){this.closeEvent.emit()}checkIsInvalid(e){return this.checkValid&&this.upsertForm.get(e)&&this.upsertForm.get(e).invalid}addRemovePeriod(e){e?this.removePeriod(e):this.periodArray.push(this._dataService.generatePeriodGroups())}removePeriod(e){this.periodArray.removeAt(e)}onRoomCheck(e,t){if(e){let e=this._dataService.generateRoomTypeGroups();e.get("vendorRoomTypeSeq").patchValue(t.vendorRoomTypeSeq),e.get("roomTypeNameEn").patchValue(t.roomTypeNameEn),this.roomTypeArray.push(e)}else this.removeRoomType(t)}onRoomCheckAll(e){const t=this.roomTypeArray;if(e)this.checkedRoomList=a.map(this.roomList,"vendorRoomTypeSeq"),this.roomList.forEach(e=>{-1==t.value.findIndex(t=>t.vendorRoomTypeSeq===e.vendorRoomTypeSeq)&&this.onRoomCheck(!0,e)});else for(this.checkedRoomList=[];0!==t.length;)t.removeAt(0)}removeRoomType(e){const t=this.roomTypeArray;t.removeAt(t.value.findIndex(t=>t.vendorRoomTypeSeq===e.vendorRoomTypeSeq))}onDayCheckAll(e,t){const n=this.periodGroup(t);n.get("appliedMonYn").patchValue(e),n.get("appliedTueYn").patchValue(e),n.get("appliedWedYn").patchValue(e),n.get("appliedThuYn").patchValue(e),n.get("appliedFriYn").patchValue(e),n.get("appliedSatYn").patchValue(e),n.get("appliedSunYn").patchValue(e)}onDayCheck(e){this.isAllDayChecked=a.every([this.periodArray.controls[0].value.appliedMonYn,this.periodArray.controls[0].value.appliedTueYn,this.periodArray.controls[0].value.appliedWedYn,this.periodArray.controls[0].value.appliedThuYn,this.periodArray.controls[0].value.appliedFriYn,this.periodArray.controls[0].value.appliedSatYn,this.periodArray.controls[0].value.appliedSunYn],Boolean)}showCalendar(e){if("exclude"===e){if(!this.periodDateCheck())return void this.alertService.alert("Input period date first.");const t=this._getPeriodMinDate(),n=i(t,"YYYY-MM-DD").year(),o=i(t,"YYYY-MM-DD").month()+1,a=[];this.periodArray.value.forEach(e=>{a.push({firstDate:e.appliedFromDate,lastDate:e.appliedToDate})}),this.openCalendarEvent.emit({type:e,isPreview:!1,minDate:{year:n,month:o},validDateRange:a})}else this.openCalendarEvent.emit({type:e,isPreview:!1,validDateRange:null})}showCalendarPreview(e){var t;const n=this._getPeriodMinDate(),o=a.min(a.concat(null===(t=this.upsertForm.get("allotmentPeriod").get("includeDates"))||void 0===t?void 0:t.value,n));if(null==o)return void this.openCalendarEvent.emit({type:"preview",isPreview:!0});const l=i(o,"YYYY-MM-DD").year(),c=i(o,"YYYY-MM-DD").month()+1,r=this._getResultDate(e);r&&this.openCalendarEvent.emit({type:"preview",isPreview:!0,minDate:{year:l,month:c},subTextDatas:r})}resetIncludeDates(){this.upsertForm.get("allotmentPeriod").get("includeDates").setValue([])}resetExcludeDates(){this.upsertForm.get("allotmentPeriod").get("excludeDates").setValue([])}_getPeriodMinDate(){const e=this.periodArray.getRawValue();return a.min(a.map(e,"appliedFromDate"))}_getResultDate(e){var t,n;let o=!1,l=[],c=[];this.periodArray.getRawValue().forEach(e=>{const t=e.appliedFromDate,n=e.appliedToDate;null!=t&&null!=n||(o=!0);const a=i(t);c.push(a.format("YYYY-MM-DD"));const l=i(n),r=i.duration(l.diff(a)).asDays();for(let o=0;o<r;o++)c.push(a.add(1,"days").format("YYYY-MM-DD"))});const r=null===(t=this.upsertForm.get("allotmentPeriod").get("includeDates"))||void 0===t?void 0:t.value,s=null===(n=this.upsertForm.get("allotmentPeriod").get("excludeDates"))||void 0===n?void 0:n.value;c=a.differenceWith(c,s,a.isEqual),r&&(c=a.concat(c,r));const b=this.roomTypeArray.getRawValue();return 0==b.length||null==b[e].addQuantity?(this.alertService.alert("Input quantity first."),null):(c.forEach(t=>{const n=i(t);if(n.isValid()){const t={day:n.date(),month:n.month()+1,year:n.year(),text:`${this._leftCountSum+b[e].addQuantity}`,pastMonthYn:!1,selectableYn:!1};l.push(t)}}),o&&!this.isImmutableIncludeDays?(this.alertService.alert("Input period date first."),null):l)}periodDateCheck(){const e=this.periodArray.value,t=a.map(e,"appliedFromDate"),n=a.map(e,"appliedToDate");return a.every(t,Boolean)&&a.every(n,Boolean)}roomTypeLabel(e){return`[${e.vendorRoomTypeSeq}] ${e.roomTypeNameEn}`}_v_isDateConditionFilled(){var e;const t=this.upsertForm.controls.allotmentPeriod.controls.includeDates,n=this._v_isPeriodArrayFilled(),o=(null===(e=t.value)||void 0===e?void 0:e.length)>0&&t.valid;return n||o}_v_isPeriodArrayFilled(){const e=this.periodArray.value;return!!((null==e?void 0:e.length)>0&&this.periodArray.valid)&&(!(1!==(null==e?void 0:e.length)||!e[0].appliedFromDate||!e[0].appliedToDate)||a.every(e,e=>e.appliedFromDate&&e.appliedToDate))}}return e.\u0275fac=function(t){return new(t||e)(o.Qb(s),o.Qb(b.a),o.Qb(u.a))},e.\u0275cmp=o.Kb({type:e,selectors:[["app-allotment-detail"]],inputs:{roomList:"roomList",checkedDateInfo:"checkedDateInfo",roomInfo:"roomInfo",includeDays:"includeDays",isImmutableIncludeDays:"isImmutableIncludeDays",excludeDays:"excludeDays",hotelSimpleInfo:"hotelSimpleInfo",contractData:"contractData"},outputs:{openCalendarEvent:"openCalendarEvent",submitEvent:"submitEvent",closeEvent:"closeEvent"},features:[o.Ab],decls:71,vars:13,consts:[[1,"main-contents-summary-inner","mb20"],[1,"font-size-lg","font-weight-bold"],[1,"promotion-rate",3,"formGroup"],[1,"page-item"],[1,"page-item-header"],[1,"table","table-bordered","table-responsive-all"],["width","130px"],["formGroupName","allotmentPeriod"],[4,"ngIf"],["scope","row",1,"th-bg"],["type","button","class","btn btn-light sm mt10 full",3,"click",4,"ngIf"],["type","button","class","btn btn btn-secondary sm mt5 mb5 full",3,"click",4,"ngIf"],[1,"textarea"],["formControlName","includeDates","cols","30","rows","3","readonly",""],[1,"item-box"],[3,"label","onChange",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"form-group","ml-auto"],["formControlName","dailySalesStopYn","name","salesStopYn","label","Daily Sales Stop Y",3,"value"],["formControlName","dailySalesStopYn","name","salesStopYn","label","Daily Sales Stop N",1,"ml10",3,"value"],["width","60%"],["scope","col",1,"align-c"],["formArrayName","roomTypes"],["style","text-align: center; font-size: 13px",4,"ngIf"],[1,"button-area","align-r","mt10"],[1,"btn","btn-secondary","sm",3,"click"],[1,"btn","btn-light","sm",3,"click"],["formArrayName","periods"],["class","form-group",4,"ngFor","ngForOf"],[1,"form-group"],[3,"formGroupName"],[1,"input","calendar","d-inline-flex","flex-fill"],[3,"for"],["type","text","placeholder","YYYY-MM-DD","formControlName","appliedFromDate",3,"matDatepicker"],["myPickerFrom",""],[1,"dash"],[1,"input","calendar","d-inline-flex","flex-fill","mr20"],["type","text","placeholder","YYYY-MM-DD","formControlName","appliedToDate",3,"matDatepicker"],["myPickerTo",""],["binary","true","label","All",3,"value","onChange"],["formControlName","appliedMonYn","binary","true","label","Mon",3,"onChange"],["formControlName","appliedTueYn","binary","true","label","Tue",3,"onChange"],["formControlName","appliedWedYn","binary","true","label","Wed",3,"onChange"],["formControlName","appliedThuYn","binary","true","label","Thu",3,"onChange"],["formControlName","appliedFriYn","binary","true","label","Fri",3,"onChange"],["formControlName","appliedSatYn","binary","true","label","Sat",3,"onChange"],["formControlName","appliedSunYn","binary","true","label","Sun",3,"onChange"],["type","button",1,"btn","btn-outline-secondary","btn-icon-only","xs","ml10",3,"click"],[1,"fas",3,"ngClass"],["type","button",1,"btn","btn-light","sm","mt10","full",3,"click"],["type","button",1,"btn","btn","btn-secondary","sm","mt5","mb5","full",3,"click"],["formControlName","excludeDates","cols","30","rows","3","readonly",""],[3,"label","onChange"],[3,"ngModel","value","label","ngModelOptions","disabled","ngModelChange","onChange"],["formControlName","addQuantity","valueType","number","placeholder","0",3,"isInvalid"],["type","button",1,"btn","btn-light","sm","w-100",3,"click"],[2,"text-align","center","font-size","13px"]],template:function(e,t){1&e&&(o.Wb(0,"div",0),o.Wb(1,"p",1),o.Pc(2),o.Vb(),o.Vb(),o.Wb(3,"div",2),o.Wb(4,"div",3),o.Wb(5,"div",4),o.Wb(6,"strong"),o.Wb(7,"sup"),o.Pc(8,"Date Condition"),o.Vb(),o.Vb(),o.Vb(),o.Wb(9,"div",5),o.Wb(10,"table"),o.Wb(11,"caption"),o.Pc(12," Date Condition "),o.Vb(),o.Wb(13,"colgroup"),o.Rb(14,"col",6),o.Rb(15,"col"),o.Vb(),o.Wb(16,"tbody",7),o.Nc(17,D,6,1,"tr",8),o.Wb(18,"tr"),o.Wb(19,"th",9),o.Pc(20," Include Days "),o.Nc(21,W,2,0,"button",10),o.Nc(22,P,2,0,"button",11),o.Vb(),o.Wb(23,"td"),o.Wb(24,"div",12),o.Rb(25,"textarea",13),o.Vb(),o.Vb(),o.Vb(),o.Nc(26,k,10,0,"tr",8),o.Vb(),o.Vb(),o.Vb(),o.Vb(),o.Wb(27,"div",3),o.Wb(28,"div",4),o.Wb(29,"strong"),o.Wb(30,"sup"),o.Pc(31,"Select Room Type"),o.Vb(),o.Vb(),o.Vb(),o.Wb(32,"div",14),o.Wb(33,"ul"),o.Wb(34,"li"),o.Nc(35,Y,1,1,"app-checkbox",15),o.Vb(),o.Nc(36,I,2,6,"li",16),o.Vb(),o.Vb(),o.Vb(),o.Wb(37,"div",3),o.Wb(38,"div",4),o.Wb(39,"strong"),o.Wb(40,"sup"),o.Pc(41,"Select Room Type"),o.Vb(),o.Vb(),o.Wb(42,"div",17),o.Rb(43,"app-radio",18),o.Rb(44,"app-radio",19),o.Vb(),o.Vb(),o.Wb(45,"div",5),o.Wb(46,"table"),o.Wb(47,"caption"),o.Pc(48," Detail option "),o.Vb(),o.Wb(49,"colgroup"),o.Rb(50,"col",20),o.Rb(51,"col"),o.Rb(52,"col"),o.Vb(),o.Wb(53,"thead"),o.Wb(54,"tr"),o.Wb(55,"th",21),o.Pc(56,"Room Type"),o.Vb(),o.Wb(57,"th",21),o.Wb(58,"sup"),o.Pc(59,"Quantity"),o.Vb(),o.Vb(),o.Wb(60,"th",21),o.Pc(61,"Preview"),o.Vb(),o.Vb(),o.Vb(),o.Wb(62,"tbody"),o.Ub(63,22),o.Nc(64,M,9,5,"tr",16),o.Tb(),o.Vb(),o.Vb(),o.Nc(65,T,2,0,"p",23),o.Vb(),o.Vb(),o.Wb(66,"div",24),o.Wb(67,"button",25),o.fc("click",(function(){return t.onSubmit()})),o.Pc(68,"Save"),o.Vb(),o.Wb(69,"button",26),o.fc("click",(function(){return t.onClose()})),o.Pc(70,"Close"),o.Vb(),o.Vb(),o.Vb()),2&e&&(o.Cb(2),o.Sc(" [",null==t.hotelSimpleInfo?null:t.hotelSimpleInfo.hotelCode,"] ",null==t.hotelSimpleInfo?null:t.hotelSimpleInfo.hotelNameEn," "),o.Cb(1),o.pc("formGroup",t.upsertForm),o.Cb(14),o.pc("ngIf",!t.isImmutableIncludeDays),o.Cb(4),o.pc("ngIf",!t.isImmutableIncludeDays),o.Cb(1),o.pc("ngIf",!t.isImmutableIncludeDays),o.Cb(4),o.pc("ngIf",!t.isImmutableIncludeDays),o.Cb(9),o.pc("ngIf",!t.isImmutableIncludeDays),o.Cb(1),o.pc("ngForOf",t.roomList),o.Cb(7),o.pc("value",!0),o.Cb(1),o.pc("value",!1),o.Cb(20),o.pc("ngForOf",null==t.roomTypeArray?null:t.roomTypeArray.controls),o.Cb(1),o.pc("ngIf",null==t.checkedRoomList||t.checkedRoomList.length<1))},directives:[r.s,r.k,r.l,d.o,r.c,r.r,r.i,d.n,h.a,r.e,p.a,m.a,f.a,v.a,d.l,r.u,y.a],styles:["textarea[_ngcontent-%COMP%]:read-only {\n        background-color: #f5f5f5;\n      }"],changeDetection:0}),e})()}}]);